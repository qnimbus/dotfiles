{{- if eq .chezmoi.os "linux" -}}
#!/usr/bin/env bash
set -euo pipefail

has() { command -v "$1" >/dev/null 2>&1; }

if has starship; then
  echo "Starship already installed."
  exit 0
fi

if has apt-get; then
  echo "Installing starship via apt…"
  if [ "$(id -u)" -ne 0 ] && has sudo; then
    sudo apt-get update -y && sudo apt-get install -y starship || true
  else
    apt-get update -y && apt-get install -y starship || true
  fi
  if has starship; then
    echo "Starship installed via apt."
    exit 0
  fi
fi

echo "Installing starship via official script to ~/.local/bin…"
mkdir -p "$HOME/.local/bin"
curl -fsSL https://starship.rs/install.sh | sh -s -- -y -b "$HOME/.local/bin"

# Ensure ~/.local/bin is on PATH for future shells (typical on Ubuntu; just in case)
case ":$PATH:" in
  *":$HOME/.local/bin:"*) ;;
  *) echo 'export PATH="$HOME/.local/bin:$PATH"' >> "$HOME/.profile" ;;
esac

if has starship; then
  echo "Starship installed via official script."
else
  echo "ERROR: Starship installation failed." >&2
  exit 1
fi
{{- end -}}
